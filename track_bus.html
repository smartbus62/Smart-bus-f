<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>تتبع الطلاب</title>
  <style>
    body {
      font-family: Arial;
      direction: rtl;
      text-align: center;
    }
    #map {
      width: 100%;
      height: 500px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>مواقع الطلاب</h2>
  <div id="map"></div>

  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js"></script>

  <script>
    // إعداد Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC9D3fE7-xxx-xxx",
      authDomain: "smart-bus-xxxx.firebaseapp.com",
      projectId: "smart-bus-xxxx",
      storageBucket: "smart-bus-xxxx.appspot.com",
      messagingSenderId: "xxx",
      appId: "xxx"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);

    // استعراض بيانات الطلاب من فايربيز
    async function loadStudentLocations() {
      const querySnapshot = await db.collection("students").get();
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 15,
        center: { lat: 24.7136, lng: 46.6753 }, // الرياض افتراضي
      });

      querySnapshot.forEach((doc) => {
        const student = doc.data();
        const studentLocation = JSON.parse(student.location);

        // إضافة دبوس لكل طالب
        new google.maps.Marker({
          position: { lat: studentLocation.lat, lng: studentLocation.lng },
          map,
          title: student.name,
          icon: "https://maps.google.com/mapfiles/kml/shapes/schools_maps.png"
        });
      });
    }

    // جلب بيانات الطلاب بعد تحميل الخريطة
    window.onload = function() {
      loadStudentLocations();
    };
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-yD3xx8VZhACAof0ps9bWYa69sS_hGJU&callback=initMap">
  </script>
</body>
</html>
