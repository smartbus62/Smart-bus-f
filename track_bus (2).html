<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>تتبع الحافلة</title>
  <style>
    body {
      font-family: Arial;
      direction: rtl;
      text-align: center;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }

    #map {
      width: 100%;
      height: 60vh;
      margin-top: 10px;
    }

    button {
      background-color: #28a745;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 18px;
      margin-top: 10px;
      padding: 10px 20px;
      border-radius: 5px;
    }

    button:hover {
      background-color: #218838;
    }
  </style>
</head>

<body>
  <h2>تتبع موقع السائق</h2>

  <div id="map"></div>
  <button onclick="loadDriverLocation()">عرض الموقع</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDbxJiBUVutivO_m6Q0-RdVohNaXauIe7Q",
      authDomain: "smart-buss-d28fc.firebaseapp.com",
      projectId: "smart-buss-d28fc",
      storageBucket: "smart-buss-d28fc.appspot.com",
      messagingSenderId: "1053196463821",
      appId: "1:1053196463821:web:36ef08cdb73e85222b8384",
      measurementId: "G-YR6THVL5H0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let map;

    async function loadDriverLocation() {
      // Get current user ID (make sure the user is logged in)
      const currentUserUid = "your-uid-here"; // Replace with the logged-in user's UID from Firebase

      // Fetch driver's data from Firestore
      const docRef = doc(db, "drivers", currentUserUid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const driverData = docSnap.data();
        const location = driverData.location.split(", "); // Convert string into latitude and longitude

        // Initialize Google Maps with the driver's location
        initMap(location[0], location[1]);
      } else {
        alert("لم يتم العثور على بيانات السائق.");
      }
    }

    function initMap(lat, lng) {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: parseFloat(lat), lng: parseFloat(lng) },
        zoom: 14,
      });

      const marker = new google.maps.Marker({
        position: { lat: parseFloat(lat), lng: parseFloat(lng) },
        map: map,
        title: "موقع السائق"
      });
    }

    window.initMap = initMap;
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-yD3xx8VZhACAof0ps9bWYa69sS_hGJU&callback=initMap">
  </script>

</body>
</html>